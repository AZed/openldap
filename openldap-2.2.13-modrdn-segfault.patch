--- openldap-2.2.13/servers/slapd/dn.c.orig	2010-06-22 11:53:34.000000000 +0200
+++ openldap-2.2.13/servers/slapd/dn.c	2010-06-22 11:56:37.000000000 +0200
@@ -282,12 +282,8 @@ LDAPDN_rewrite( LDAPDN dn, unsigned flag
 			ava->la_attr = ad->ad_cname;
 
 			if( ava->la_flags & LDAP_AVA_BINARY ) {
-				if( ava->la_value.bv_len == 0 ) {
-					/* BER encoding is empty */
-					return LDAP_INVALID_SYNTAX;
-				}
-
-				/* AVA is binary encoded, don't muck with it */
+				/* AVA is binary encoded, not supported */
+				return LDAP_INVALID_SYNTAX;
 			} else if( flags & SLAP_LDAPDN_PRETTY ) {
 				transf = ad->ad_type->sat_syntax->ssyn_pretty;
 				if( !transf ) {
@@ -354,6 +350,11 @@ LDAPDN_rewrite( LDAPDN dn, unsigned flag
 				ava->la_flags |= LDAP_AVA_FREE_VALUE;
 			}
 
+			/* reject empty values */
+			if (!ava->la_value.bv_len) {
+				return LDAP_INVALID_SYNTAX;
+			}
+
 			if( do_sort ) AVA_Sort( rdn, iAVA );
 		}
 	}
--- openldap-2.2.13/servers/slapd/modrdn.c.orig	2010-06-22 11:56:53.000000000 +0200
+++ openldap-2.2.13/servers/slapd/modrdn.c	2010-06-22 12:30:34.000000000 +0200
@@ -532,12 +532,19 @@ slap_modrdn2mods(
 		mod_tmp->sml_values[1].bv_val = NULL;
 		if( desc->ad_type->sat_equality->smr_normalize) {
 			mod_tmp->sml_nvalues = &mod_tmp->sml_values[2];
-			(void) (*desc->ad_type->sat_equality->smr_normalize)(
+			rs->sr_err = desc->ad_type->sat_equality->smr_normalize(
 				SLAP_MR_EQUALITY|SLAP_MR_VALUE_OF_ASSERTION_SYNTAX,
 				desc->ad_type->sat_syntax,
 				desc->ad_type->sat_equality,
 				&mod_tmp->sml_values[0],
 				&mod_tmp->sml_nvalues[0], op->o_tmpmemctx );
+			if (rs->sr_err != LDAP_SUCCESS) {
+				ch_free(mod_tmp->sml_nvalues);
+				ch_free(mod_tmp->sml_values[0].bv_val);
+				ch_free(mod_tmp->sml_values);
+				ch_free(mod_tmp);
+				goto done;
+			}
 			mod_tmp->sml_nvalues[1].bv_val = NULL;
 		} else {
 			mod_tmp->sml_nvalues = NULL;
--- openldap-2.2.13/servers/slapd/schema_init.c.orig	2010-06-22 12:30:57.000000000 +0200
+++ openldap-2.2.13/servers/slapd/schema_init.c	2010-06-22 12:34:10.000000000 +0200
@@ -1202,8 +1202,9 @@ UTF8StringNormalize(
 		? LDAP_UTF8_APPROX : 0;
 
 	val = UTF8bvnormalize( val, &tmp, flags, ctx );
+	/* out of memory or syntax error, the former is unlikely */
 	if( val == NULL ) {
-		return LDAP_OTHER;
+		return LDAP_INVALID_SYNTAX;
 	}
 	
 	/* collapse spaces (in place) */
